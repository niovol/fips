# Парсер патентов ФИПС

Инструмент для автоматизированного сбора информации о патентах из базы данных ФИПС (Федеральный институт промышленной собственности) — [https://new.fips.ru/iiss/](https://new.fips.ru/iiss/). Скрипты позволяют искать патенты по различным статусам и собирать результаты в удобных форматах (CSV и XLSX).

## Содержание

1. [Описание](#описание)
2. [Требования и установка](#требования-и-установка)
3. [Использование](#использование)
   - [Запуск скриптов](#запуск-скриптов)
   - [Поиск по конкретным статусам](#поиск-по-конкретным-статусам)
   - [Настройка поиска и параметров](#настройка-поиска-и-параметров)
4. [Структура проекта](#структура-проекта)
5. [Формат выходных данных](#формат-выходных-данных)
6. [Режим тестирования](#режим-тестирования)
7. [Поддержка и отладка](#поддержка-и-отладка)

---

## Описание

Данный парсер предназначен для:

- **Поиска** патентов по ключевым словам (например, по владельцу).
- **Фильтрации** результатов поиска по статусам:
  - Действует
  - Может прекратить свое действие
  - Прекратил действие, но может быть восстановлен
  - Прекратил действие
- **Сбора** детальной информации о каждом найденном патенте:
  - Дата публикации
  - Номер и тип документа
  - Статус, пошлина
  - Владельцы, заявители, МПК, СПК и т.д.
- **Сохранения** полученных данных:
  - Краткая информация — в CSV
  - Подробная (по каждому патенту) — в отдельные XLSX-файлы

---

## Требования и установка

1. **Python 3.9+**.
2. **Google Chrome** (актуальная версия).
3. **Доступ в интернет**.

### Установка

1. Склонируйте репозиторий или скачайте код:

   ```bash
   git clone https://github.com/niovol/fips
   cd fips
   ```

2. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Убедитесь, что у вас установлен **Google Chrome**.  
   `webdriver-manager` автоматически подберёт подходящий драйвер.

---

## Использование

### Запуск скриптов

Для запуска *базового поиска* (по всем статусам патентов):

```bash
python -m parse_all
```

Скрипт запустит Chrome, произведёт поиск с настройками по умолчанию и сохранит результаты.

### Поиск по конкретным статусам

В проекте есть скрипты, которые позволяют фильтровать результаты поиска по статусам:

- `parse_active.py`  
  Ищет только патенты со статусом **«Действует»**.
  
- `parse_may_terminate.py`  
  Ищет патенты, которые **«Могут прекратить»** действие.
  
- `parse_terminated_recoverable.py`  
  Ищет патенты, которые **«Прекратили действие, но могут быть восстановлены»**.
  
- `parse_terminated.py`  
  Ищет патенты, которые **«Прекратили действие»**.

Пример запуска:

```bash
python -m parse_active
```

### Настройка поиска и параметров

По умолчанию используется следующий поисковый запрос (см. `fips/parser.py`, метод `start_search()`):

```python
"аэрогидродинамический or (аэрогидродинамический институт) or (цаги not научно)"
```

Чтобы изменить запрос, отредактируйте значение параметра `query` в `start_search()`.

#### Дополнительные параметры

При создании экземпляра `FIPSParser` в скриптах можно передать:

```python
parser = FIPSParser(
    base_dir=Path.cwd(),           # базовая директория для сохранения результатов
    status_options=status_options, # экземпляр StatusOptions для фильтрации по статусам
    test_mode=False                # режим тестирования (ограничение результатов)
)
```

---

## Структура проекта

Основные файлы:

- **parse_*.py** — точка входа для разных сценариев поиска (active, all, terminated и т.д.).
- **requirements.txt** — список зависимостей.
- **fips/logger.py** — настройка логирования.
- **fips/models.py** — описания моделей данных (статусы, структура патентов).
- **fips/parser.py** — основной парсер:
  - Настройка поиска
  - Получение списка патентов
  - Переход к детальной карточке
- **fips/storage.py** — класс для сохранения данных (`PatentStorage`):
  - Сохранение краткой информации в CSV
  - Сохранение детальной информации в XLSX
- **fips/web.py** — управление Selenium WebDriver (Chrome).

---

## Формат выходных данных

После завершения работы в папке **output** появятся:

- **CSV-файл** `YYYYMMDD_HHMMSS.csv` — краткая сводка о каждом найденном патенте:
  - Номер, дата публикации, название, тип документа, ID ссылки, URL изображения
- **Каталог** `YYYYMMDD_HHMMSS/` с таким же именем, в котором для каждого патента создаётся отдельный XLSX-файл с детальной информацией:
  - Ссылка на патент
  - Документ (номер)
  - МПК
  - СПК
  - Статус, пошлина
  - Прочие данные
  - Название

Пример:

```
output/
 ┣ 20250214_125947.csv
 ┗ 20250214_125947/
    ┣ 2820873.xlsx
    ┣ 2821002.xlsx
    ┣ ...
    ┗ ...
```

---

## Режим тестирования

Для отладки или быстрого теста можно использовать `parse_test.py`, где установлен `test_mode=True`. В таком режиме:

- Обрабатываются только первые **3 страницы** результатов.
- С каждой страницы собираются только **5 первых** патентов.

Это помогает быстро проверить корректность логики, не тратя много времени и не загружая сайт ФИПС.

---

## Поддержка и отладка

1. Убедитесь, что все **зависимости** установлены корректно:

   ```bash
   pip install -r requirements.txt
   ```

2. Убедитесь, что установлен **Google Chrome** и что версия драйвера соответствует браузеру (это делает `webdriver-manager` автоматически).
3. Проверьте **стабильность интернет-соединения** — скрипт общается с сайтом в реальном времени.
4. Посмотрите **логи** (вывод в консоль) — там указывается причина возможной ошибки.  
